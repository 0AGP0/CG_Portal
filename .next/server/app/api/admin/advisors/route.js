"use strict";(()=>{var e={};e.id=3277,e.ids=[3277],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10701:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{GET:()=>d,POST:()=>u});var s=t(32190),n=t(5069),i=t(86481),o=e([n]);async function d(e){try{let e=await n.dz.connect();try{let a=`
        SELECT 
          id,
          name,
          email,
          created_at,
          updated_at,
          (SELECT COUNT(*) FROM students WHERE advisor_email = advisors.email) as student_count
        FROM advisors
        ORDER BY updated_at DESC
      `,t=(await e.query(a)).rows.map(e=>({id:e.id,name:e.name,email:e.email,studentCount:parseInt(e.student_count)||0,updatedAt:e.updated_at}));return s.NextResponse.json({success:!0,advisors:t})}finally{e.release()}}catch(e){return i.vF.error("Admin danışman listesi hatası:",e),s.NextResponse.json({error:"Danışman listesi alınamadı"},{status:500})}}async function u(e){try{let a=await e.json();if(!a.email||!a.name)return s.NextResponse.json({error:"Ad ve e-posta alanları zorunludur"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email))return s.NextResponse.json({error:"Ge\xe7erli bir e-posta adresi girin"},{status:400});let t=await n.dz.connect();try{if((await t.query("SELECT id FROM advisors WHERE email = $1",[a.email])).rows.length>0)return s.NextResponse.json({error:"Bu e-posta adresi zaten kullanımda"},{status:400});let e=`
        INSERT INTO advisors (name, email, created_at, updated_at)
        VALUES ($1, $2, NOW(), NOW())
        RETURNING id, name, email, created_at, updated_at
      `,r=(await t.query(e,[a.name,a.email])).rows[0];return s.NextResponse.json({success:!0,advisor:{id:r.id,name:r.name,email:r.email,studentCount:0,createdAt:r.created_at,updatedAt:r.updated_at}},{status:201})}finally{t.release()}}catch(e){return i.vF.error("Danışman oluşturma hatası:",e),s.NextResponse.json({error:"Danışman oluşturulurken bir hata oluştu"},{status:500})}}n=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},53786:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{patchFetch:()=>u,routeModule:()=>p,serverHooks:()=>c,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var s=t(96559),n=t(48088),i=t(37719),o=t(10701),d=e([o]);o=(d.then?(await d)():d)[0];let p=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/advisors/route",pathname:"/api/admin/advisors",filename:"route",bundlePath:"app/api/admin/advisors/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\admin\\advisors\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:c}=p;function u(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}r()}catch(e){r(e)}})},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{e.exports=import("pg")}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[4447,580,8033],()=>t(53786));module.exports=r})();