"use strict";(()=>{var e={};e.id=3438,e.ids=[3438],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10416:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{GET:()=>d,POST:()=>u});var s=t(32190),n=t(5069),o=t(86481),i=e([n]);async function d(e){o.vF.info("=== ADMIN STUDENTS API BAŞLADI ===");let a=s.NextResponse.next();a.headers.set("Cache-Control","no-cache, no-store, must-revalidate"),a.headers.set("Pragma","no-cache"),a.headers.set("Expires","0");try{let e=await n.dz.connect();o.vF.info("Veritabanı bağlantısı kuruldu");try{let a=`
        SELECT 
          s.*,
          COALESCE(a.name, 'Atanmadı') as advisor_name,
          a.email as advisor_email
        FROM students s
        LEFT JOIN advisors a ON s.advisor_email = a.email
        ORDER BY s.created_at DESC
      `;o.vF.info("SQL sorgusu:",a);let t=await e.query(a);o.vF.info("Sorgu sonucu:",{rowCount:t.rowCount,rows:t.rows});let r=t.rows.map(e=>({id:e.email,name:e.name,email:e.email,phone:e.phone||"",advisor:e.advisor_name||"Atanmadı",status:e.stage||"Beklemede",processStarted:e.process_started||!1,createdAt:e.created_at,updatedAt:e.updated_at,advisorId:e.advisor_id,advisorEmail:e.advisor_email,documents:e.documents||[]}));o.vF.info("\xd6ğrenci verileri formatlandı:",{formattedCount:r.length});let n=s.NextResponse.json({success:!0,students:r});return n.headers.set("Cache-Control","no-cache, no-store, must-revalidate"),n.headers.set("Pragma","no-cache"),n.headers.set("Expires","0"),n}finally{e.release(),o.vF.info("Veritabanı bağlantısı kapatıldı")}}catch(e){return o.vF.error("=== ADMIN STUDENTS API HATASI ==="),o.vF.error("Hata mesajı:",e.message),o.vF.error("Hata kodu:",e.code),o.vF.error("Hata detayı:",e.detail),o.vF.error("Hata stack:",e.stack),s.NextResponse.json({error:"\xd6ğrenci listesi alınırken bir hata oluştu",details:e.message},{status:500})}}async function u(e){try{let a=await e.json();if(!a.email||!a.name)return s.NextResponse.json({error:"Ad ve e-posta alanları zorunludur"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email))return s.NextResponse.json({error:"Ge\xe7erli bir e-posta adresi girin"},{status:400});let t=await n.dz.connect();try{let e=`
        INSERT INTO students (email, name, phone, stage, process_started, created_at, updated_at)
        VALUES ($1, $2, $3, $4, $5, NOW(), NOW())
        RETURNING *
      `,r=(await t.query(e,[a.email,a.name,a.phone||"","Hazırlık Aşaması",!1])).rows[0];return o.vF.info("Yeni \xf6ğrenci oluşturuldu",{email:r.email}),s.NextResponse.json({success:!0,student:{id:r.email,name:r.name,email:r.email,phone:r.phone,advisor:"Atanmadı",status:r.stage,processStarted:r.process_started,createdAt:r.created_at,updatedAt:r.updated_at}},{status:201})}finally{t.release()}}catch(e){return o.vF.error("\xd6ğrenci oluşturma hatası:",e),s.NextResponse.json({error:"\xd6ğrenci oluşturulurken bir hata oluştu"},{status:500})}}n=(i.then?(await i)():i)[0],r()}catch(e){r(e)}})},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25168:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{patchFetch:()=>u,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>p});var s=t(96559),n=t(48088),o=t(37719),i=t(10416),d=e([i]);i=(d.then?(await d)():d)[0];let l=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/students/route",pathname:"/api/admin/students",filename:"route",bundlePath:"app/api/admin/students/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\admin\\students\\route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:c,workUnitAsyncStorage:p,serverHooks:m}=l;function u(){return(0,o.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:p})}r()}catch(e){r(e)}})},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{e.exports=import("pg")}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[4447,580,8033],()=>t(25168));module.exports=r})();