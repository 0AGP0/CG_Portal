(()=>{var e={};e.id=2405,e.ids=[2405],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},28472:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{patchFetch:()=>u,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var o=r(96559),n=r(48088),s=r(37719),i=r(47039),c=e([i]);i=(c.then?(await c)():c)[0];let l=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/odoo-webhook/docs/route",pathname:"/api/odoo-webhook/docs",filename:"route",bundlePath:"app/api/odoo-webhook/docs/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\odoo-webhook\\docs\\route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:m}=l;function u(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}a()}catch(e){a(e)}})},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34808:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{A$:()=>p,Bx:()=>h,CT:()=>d,Wv:()=>m,Z7:()=>u,_Y:()=>c,iW:()=>l,kA:()=>w,v3:()=>i});var o=r(86481),n=r(64939),s=e([n]);new(n=(s.then?(await s)():s)[0]).Pool({user:process.env.POSTGRES_USER||"postgres",host:process.env.POSTGRES_HOST||"localhost",database:process.env.POSTGRES_DATABASE||"cg_portal",password:process.env.POSTGRES_PASSWORD,port:parseInt(process.env.POSTGRES_PORT||"5432"),ssl:{rejectUnauthorized:!1}});let y={customers:new Map,advisors:new Map,messages:new Map,lastUpdated:new Map};async function i(e){try{let t=y.customers.get(e),r=y.lastUpdated.get(e);if(t&&r&&Date.now()-r<3e5)return t;let a=await fetch("/api/student/profile",{headers:{"x-user-email":e,"Content-Type":"application/json"}});if(!a.ok)throw Error("\xd6ğrenci bilgisi alınamadı");let o=await a.json();if(!o.success)return null;return y.customers.set(e,o.student),y.lastUpdated.set(e,Date.now()),o.student}catch(e){return console.error("\xd6ğrenci kaydı getirme hatası:",e),null}}async function c(e,t){try{o.vF.info("Danışman arama başlatıldı:",e);let r=`advisor_${e}`,a=y.advisors.get(r);if(a)return o.vF.info("Danışman bilgileri cache'den getirildi:",e),a;if(!t)throw o.vF.error("Token bulunamadı"),Error("Oturum s\xfcresi doldu. L\xfctfen tekrar giriş yapın.");let n=`https://your-domain.com/api/advisor/${encodeURIComponent(e)}`;o.vF.info("Danışman API isteği g\xf6nderiliyor:",n);let s={"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${t}`,"x-user-email":e,"x-user-role":"advisor"},i=await fetch(n,{method:"GET",headers:s,credentials:"include"});if(!i.ok){if(401===i.status)throw o.vF.error("Danışman oturumu ge\xe7ersiz:",e),y.advisors.delete(r),Error("Oturum s\xfcresi doldu. L\xfctfen tekrar giriş yapın.");throw Error(`Danışman bilgileri alınamadı: ${i.statusText}`)}let c=await i.json();if(!c.success)throw o.vF.error("Danışman API yanıt hatası:",c.error),Error(c.error||"Danışman bilgileri alınamadı");let u=c.advisor;if(!u)return o.vF.error("Danışman bulunamadı:",e),null;return y.advisors.set(r,u),o.vF.info("Danışman bilgileri başarıyla getirildi:",e),u}catch(e){throw o.vF.error("Danışman kaydı getirme hatası:",e),e}}async function u(e){try{var t;let r=(t=`/api/messages/${e}/read`,`https://your-domain.com${t}`),a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok)throw Error("Mesaj okundu olarak işaretlenemedi");return(await a.json()).success}catch(e){return console.error("Mesaj okundu işaretleme hatası:",e),!1}}async function l(e){try{let t=await fetch("/api/student/profile",{method:"PUT",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!t.ok)throw Error("Kayıt g\xfcncellenemedi");return(await t.json()).student}catch(e){throw console.error("Kayıt g\xfcncelleme hatası:",e),e}}async function d(){try{let e=await fetch("/api/advisor/list");if(!e.ok)throw Error("Danışman listesi alınamadı");return(await e.json()).advisors||[]}catch(e){return console.error("Danışman listesi getirme hatası:",e),[]}}async function p(e){try{let t=await fetch("/api/student/documents",{method:"POST",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!t.ok)throw Error("D\xf6k\xfcman g\xfcncellenemedi");return(await t.json()).document}catch(e){throw console.error("D\xf6k\xfcman g\xfcncelleme hatası:",e),e}}async function m(e){try{let t=await fetch("/api/student/visa",{method:"PUT",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!t.ok)throw Error("Vize bilgisi g\xfcncellenemedi");return(await t.json()).student}catch(e){throw console.error("Vize g\xfcncelleme hatası:",e),e}}async function h(e){try{let t=await fetch("/api/advisor/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Danışman g\xfcncellenemedi");return(await t.json()).advisor}catch(e){throw console.error("Danışman g\xfcncelleme hatası:",e),e}}async function w(e){try{let t=await fetch(`/api/messages/${e}`);if(!t.ok)return null;return(await t.json()).message}catch(e){return console.error("Mesaj getirme hatası:",e),null}}a()}catch(e){a(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47039:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{POST:()=>c});var o=r(32190),n=r(34808),s=r(86481),i=e([n]);async function c(e){try{let t=await e.json(),r=new URL(e.url).searchParams.get("secret")||"",a=t.email||t.x_studio_mail_adresi||null,i=t.document_type||t.x_studio_document_type,c=t.document_url||t.x_studio_document_url,u=t.document_name||t.x_studio_document_name||"Belge";if((0,s.SB)("odoo-webhook-docs","success",{email:a,document_type:i}),r!==process.env.ODOO_WEBHOOK_SECRET)return(0,s.vV)("Ge\xe7ersiz dok\xfcman webhook secret parametresi",{secretParam:r}),o.NextResponse.json({error:"Ge\xe7ersiz g\xfcvenlik anahtarı"},{status:401});if(!a||!i||!c)return(0,s.vV)("Eksik dok\xfcman bilgisi",t),o.NextResponse.json({error:"Email, dok\xfcman tipi veya URL bilgisi eksik"},{status:400});let l=await (0,n.A$)({email:a,documentType:i,documentUrl:c,documentName:u,updatedAt:new Date().toISOString()});return o.NextResponse.json({success:!0,result:l},{status:200})}catch(e){return(0,s.vV)("Dok\xfcman webhook işleme hatası",e),o.NextResponse.json({error:"İşlem hatası"},{status:500})}}n=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},78335:()=>{},86481:(e,t,r)=>{"use strict";r.d(t,{SB:()=>s,fH:()=>n,vF:()=>a,vV:()=>o});let a={info:(...e)=>{},error:(...e)=>{},warn:(...e)=>{},debug:(...e)=>{}},o=(e,t)=>{a.error(e,t)},n=(e,t)=>{a.info(e,t)},s=(e,t,r)=>{let o=`Webhook alındı: ${e} - Durum: ${t}`;"error"===t?a.error(o,r):a.info(o,r)}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580],()=>r(28472));module.exports=a})();