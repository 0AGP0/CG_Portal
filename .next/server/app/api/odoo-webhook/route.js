(()=>{var e={};e.id=3057,e.ids=[3057],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34808:(e,i,t)=>{"use strict";t.a(e,async(e,_)=>{try{t.d(i,{A$:()=>c,Bx:()=>x,CT:()=>l,Wv:()=>m,Z7:()=>u,_Y:()=>n,iW:()=>d,kA:()=>h,v3:()=>r});var a=t(86481),o=t(64939),s=e([o]);new(o=(s.then?(await s)():s)[0]).Pool({user:process.env.POSTGRES_USER||"postgres",host:process.env.POSTGRES_HOST||"localhost",database:process.env.POSTGRES_DATABASE||"cg_portal",password:process.env.POSTGRES_PASSWORD,port:parseInt(process.env.POSTGRES_PORT||"5432"),ssl:{rejectUnauthorized:!1}});let y={customers:new Map,advisors:new Map,messages:new Map,lastUpdated:new Map};async function r(e){try{let i=y.customers.get(e),t=y.lastUpdated.get(e);if(i&&t&&Date.now()-t<3e5)return i;let _=await fetch("/api/student/profile",{headers:{"x-user-email":e,"Content-Type":"application/json"}});if(!_.ok)throw Error("\xd6ğrenci bilgisi alınamadı");let a=await _.json();if(!a.success)return null;return y.customers.set(e,a.student),y.lastUpdated.set(e,Date.now()),a.student}catch(e){return console.error("\xd6ğrenci kaydı getirme hatası:",e),null}}async function n(e,i){try{a.vF.info("Danışman arama başlatıldı:",e);let t=`advisor_${e}`,_=y.advisors.get(t);if(_)return a.vF.info("Danışman bilgileri cache'den getirildi:",e),_;if(!i)throw a.vF.error("Token bulunamadı"),Error("Oturum s\xfcresi doldu. L\xfctfen tekrar giriş yapın.");let o=`https://your-domain.com/api/advisor/${encodeURIComponent(e)}`;a.vF.info("Danışman API isteği g\xf6nderiliyor:",o);let s={"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${i}`,"x-user-email":e,"x-user-role":"advisor"},r=await fetch(o,{method:"GET",headers:s,credentials:"include"});if(!r.ok){if(401===r.status)throw a.vF.error("Danışman oturumu ge\xe7ersiz:",e),y.advisors.delete(t),Error("Oturum s\xfcresi doldu. L\xfctfen tekrar giriş yapın.");throw Error(`Danışman bilgileri alınamadı: ${r.statusText}`)}let n=await r.json();if(!n.success)throw a.vF.error("Danışman API yanıt hatası:",n.error),Error(n.error||"Danışman bilgileri alınamadı");let u=n.advisor;if(!u)return a.vF.error("Danışman bulunamadı:",e),null;return y.advisors.set(t,u),a.vF.info("Danışman bilgileri başarıyla getirildi:",e),u}catch(e){throw a.vF.error("Danışman kaydı getirme hatası:",e),e}}async function u(e){try{var i;let t=(i=`/api/messages/${e}/read`,`https://your-domain.com${i}`),_=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"}});if(!_.ok)throw Error("Mesaj okundu olarak işaretlenemedi");return(await _.json()).success}catch(e){return console.error("Mesaj okundu işaretleme hatası:",e),!1}}async function d(e){try{let i=await fetch("/api/student/profile",{method:"PUT",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!i.ok)throw Error("Kayıt g\xfcncellenemedi");return(await i.json()).student}catch(e){throw console.error("Kayıt g\xfcncelleme hatası:",e),e}}async function l(){try{let e=await fetch("/api/advisor/list");if(!e.ok)throw Error("Danışman listesi alınamadı");return(await e.json()).advisors||[]}catch(e){return console.error("Danışman listesi getirme hatası:",e),[]}}async function c(e){try{let i=await fetch("/api/student/documents",{method:"POST",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!i.ok)throw Error("D\xf6k\xfcman g\xfcncellenemedi");return(await i.json()).document}catch(e){throw console.error("D\xf6k\xfcman g\xfcncelleme hatası:",e),e}}async function m(e){try{let i=await fetch("/api/student/visa",{method:"PUT",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!i.ok)throw Error("Vize bilgisi g\xfcncellenemedi");return(await i.json()).student}catch(e){throw console.error("Vize g\xfcncelleme hatası:",e),e}}async function x(e){try{let i=await fetch("/api/advisor/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw Error("Danışman g\xfcncellenemedi");return(await i.json()).advisor}catch(e){throw console.error("Danışman g\xfcncelleme hatası:",e),e}}async function h(e){try{let i=await fetch(`/api/messages/${e}`);if(!i.ok)return null;return(await i.json()).message}catch(e){return console.error("Mesaj getirme hatası:",e),null}}_()}catch(e){_(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},75577:(e,i,t)=>{"use strict";t.a(e,async(e,_)=>{try{t.r(i),t.d(i,{POST:()=>n});var a=t(32190),o=t(34808),s=t(86481),r=e([o]);o=(r.then?(await r)():r)[0];let u="e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";async function n(e){console.log("\n=== WEBHOOK İSTEĞİ BAŞLADI ==="),console.log("Zaman:",new Date().toISOString()),console.log("Method:",e.method),console.log("URL:",e.url);let i=Object.fromEntries(e.headers.entries());console.log("Headers:",JSON.stringify(i,null,2));try{let i,t=new URL(e.url).searchParams.get("secret")||"";if(console.log("\nSecret Kontrol\xfc:"),console.log("- Alınan:",t.substring(0,10)+"..."),console.log("- Beklenen:",u.substring(0,10)+"..."),t!==u)return console.error("❌ Ge\xe7ersiz webhook secret"),a.NextResponse.json({error:"Unauthorized - Invalid secret"},{status:401});console.log("✅ Secret doğrulandı");let _=await e.text();console.log("\nHam Veri:",_);try{i=JSON.parse(_),console.log("\nİşlenmiş Veri:",JSON.stringify(i,null,2))}catch(e){return console.error("❌ JSON parse hatası:",e),a.NextResponse.json({error:"Invalid JSON body"},{status:400})}let s=i.x_studio_mail_adresi||i.email||null;if(console.log("\nEmail Kontrol\xfc:",s),!s)return console.error("❌ Email alanı bulunamadı"),a.NextResponse.json({error:"Email field is required"},{status:400});console.log("✅ Email doğrulandı"),console.log("\n\xd6ğrenci kontrol\xfc yapılıyor...");let r=await (0,o.v3)(s);if(!r)return console.error("❌ Bu email adresiyle kayıtlı \xf6ğrenci bulunamadı:",s),a.NextResponse.json({error:"Student not found",message:"Bu email adresiyle kayıtlı \xf6ğrenci bulunamadı",email:s},{status:404});console.log("✅ \xd6ğrenci bulundu:",r.name);let n=i.x_studio_selection_field_8en_1iqnrqang||i.stage||"";console.log("\nDurum Kontrol\xfc:",n),console.log("\n\xd6ğrenci g\xfcncelleniyor...");let d=await (0,o.iW)({email:s,name:i.name||r.name,phone:i.phone||r.phone,contact_address:i.contact_address||r.contact_address,stage:n,processStarted:!0,updatedAt:new Date().toISOString(),webhook_updated:!0,webhook_update_timestamp:new Date().toISOString(),x_studio_doum_tarihi:i.x_studio_doum_tarihi||r.x_studio_doum_tarihi,x_studio_doum_yeri:i.x_studio_doum_yeri||r.x_studio_doum_yeri,x_studio_ya:i.x_studio_ya||r.x_studio_ya,x_studio_medeni_durum_1:i.x_studio_medeni_durum_1||r.x_studio_medeni_durum_1,x_studio_finansal_kant:i.x_studio_finansal_kant||r.x_studio_finansal_kant,x_studio_pasaport_numaras:i.x_studio_pasaport_numaras||r.x_studio_pasaport_numaras,x_studio_pasaport_tr:i.x_studio_pasaport_tr||r.x_studio_pasaport_tr,x_studio_verili_tarihi:i.x_studio_verili_tarihi||r.x_studio_verili_tarihi,x_studio_geerlilik_tarihi:i.x_studio_geerlilik_tarihi||r.x_studio_geerlilik_tarihi,x_studio_veren_makam:i.x_studio_veren_makam||r.x_studio_veren_makam,x_studio_pnr_numaras:i.x_studio_pnr_numaras||r.x_studio_pnr_numaras,x_studio_anne_ad:i.x_studio_anne_ad||r.x_studio_anne_ad,x_studio_anne_soyad:i.x_studio_anne_soyad||r.x_studio_anne_soyad,x_studio_anne_doum_tarihi:i.x_studio_anne_doum_tarihi||r.x_studio_anne_doum_tarihi,x_studio_anne_doum_yeri:i.x_studio_anne_doum_yeri||r.x_studio_anne_doum_yeri,x_studio_anne_ikamet_sehrilke:i.x_studio_anne_ikamet_sehrilke||r.x_studio_anne_ikamet_sehrilke,x_studio_anne_telefon:i.x_studio_anne_telefon||r.x_studio_anne_telefon,x_studio_baba_ad:i.x_studio_baba_ad||r.x_studio_baba_ad,x_studio_baba_soyad:i.x_studio_baba_soyad||r.x_studio_baba_soyad,x_studio_baba_doum_tarihi:i.x_studio_baba_doum_tarihi||r.x_studio_baba_doum_tarihi,x_studio_baba_doum_yeri:i.x_studio_baba_doum_yeri||r.x_studio_baba_doum_yeri,x_studio_baba_ikamet_ehrilkesi:i.x_studio_baba_ikamet_ehrilkesi||r.x_studio_baba_ikamet_ehrilkesi,x_studio_baba_telefon:i.x_studio_baba_telefon||r.x_studio_baba_telefon,x_studio_lise_ad:i.x_studio_lise_ad||r.x_studio_lise_ad,x_studio_lise_tr:i.x_studio_lise_tr||r.x_studio_lise_tr,x_studio_lise_ehir:i.x_studio_lise_ehir||r.x_studio_lise_ehir,x_studio_lise_biti_tarihi:i.x_studio_lise_biti_tarihi||r.x_studio_lise_biti_tarihi,x_studio_lise_balang_tarihi_1:i.x_studio_lise_balang_tarihi_1||r.x_studio_lise_balang_tarihi_1,x_studio_niversite_ad:i.x_studio_niversite_ad||r.x_studio_niversite_ad,x_studio_niversite_blm_ad:i.x_studio_niversite_blm_ad||r.x_studio_niversite_blm_ad,x_studio_niversite_balang_tarihi:i.x_studio_niversite_balang_tarihi||r.x_studio_niversite_balang_tarihi,x_studio_niversite_biti_tarihi:i.x_studio_niversite_biti_tarihi||r.x_studio_niversite_biti_tarihi,x_studio_mezuniyet_durumu:i.x_studio_mezuniyet_durumu||r.x_studio_mezuniyet_durumu,x_studio_mezuniyet_yl:i.x_studio_mezuniyet_yl||r.x_studio_mezuniyet_yl,x_studio_almanca_seviyesi_1:i.x_studio_almanca_seviyesi_1||r.x_studio_almanca_seviyesi_1,x_studio_almanca_sertifikas:i.x_studio_almanca_sertifikas||r.x_studio_almanca_sertifikas,x_studio_dil_kursu_kayt:i.x_studio_dil_kursu_kayt||r.x_studio_dil_kursu_kayt,x_studio_dil_renim_durumu:i.x_studio_dil_renim_durumu||r.x_studio_dil_renim_durumu,x_studio_sym_snav_giri:i.x_studio_sym_snav_giri||r.x_studio_sym_snav_giri,x_studio_sym_yerlestirme_sonuc_tarihi:i.x_studio_sym_yerlestirme_sonuc_tarihi||r.x_studio_sym_yerlestirme_sonuc_tarihi,x_studio_vize_randevu_tarihi:i.x_studio_vize_randevu_tarihi||r.x_studio_vize_randevu_tarihi,x_studio_vize_bavuru_tarihi_1:i.x_studio_vize_bavuru_tarihi_1||r.x_studio_vize_bavuru_tarihi_1,x_studio_konsolosluk_1:i.x_studio_konsolosluk_1||r.x_studio_konsolosluk_1,x_studio_vize_randevu_belgesi:i.x_studio_vize_randevu_belgesi||r.x_studio_vize_randevu_belgesi,x_studio_almanya_bulunma:i.x_studio_almanya_bulunma||r.x_studio_almanya_bulunma,x_studio_de_blm_tercihi:i.x_studio_de_blm_tercihi||r.x_studio_de_blm_tercihi,x_studio_niversite_tercihleri:i.x_studio_niversite_tercihleri||r.x_studio_niversite_tercihleri,x_studio_maddi_kant_durumu:i.x_studio_maddi_kant_durumu||r.x_studio_maddi_kant_durumu,x_studio_bilgiler_1:i.x_studio_bilgiler_1||r.x_studio_bilgiler_1,x_studio_es_ad_soyad:i.x_studio_es_ad_soyad||r.x_studio_es_ad_soyad,x_studio_es_klk_soyad:i.x_studio_es_klk_soyad||r.x_studio_es_klk_soyad,x_studio_es_doum_tarihi:i.x_studio_es_doum_tarihi||r.x_studio_es_doum_tarihi,x_studio_es_doum_yeri:i.x_studio_es_doum_yeri||r.x_studio_es_doum_yeri,x_studio_es_ikamet:i.x_studio_es_ikamet||r.x_studio_es_ikamet,x_studio_cocuk_var_m:i.x_studio_cocuk_var_m||r.x_studio_cocuk_var_m,x_studio_cocuk_ad_soyad:i.x_studio_cocuk_ad_soyad||r.x_studio_cocuk_ad_soyad,x_studio_cocuk_doum_tarihi:i.x_studio_cocuk_doum_tarihi||r.x_studio_cocuk_doum_tarihi,x_studio_cocuk_doum_yeri:i.x_studio_cocuk_doum_yeri||r.x_studio_cocuk_doum_yeri,x_studio_cocuk_vatandaslik:i.x_studio_cocuk_vatandaslik||r.x_studio_cocuk_vatandaslik,x_studio_cocuk_ikamet:i.x_studio_cocuk_ikamet||r.x_studio_cocuk_ikamet,x_studio_almanya_bulunma_tarihleri:i.x_studio_almanya_bulunma_tarihleri||r.x_studio_almanya_bulunma_tarihleri,x_studio_almanya_bulunma_sehir:i.x_studio_almanya_bulunma_sehir||r.x_studio_almanya_bulunma_sehir});return console.log("\n✅ \xd6ğrenci başarıyla g\xfcncellendi:",JSON.stringify(d,null,2)),a.NextResponse.json({success:!0,message:"\xd6ğrenci bilgileri g\xfcncellendi",student:d},{status:200})}catch(e){return console.error("\n❌ Webhook işleme hatası:",e),(0,s.vV)("Webhook error",e),a.NextResponse.json({error:"Internal server error",details:e.message},{status:500})}finally{console.log("\n=== WEBHOOK İSTEĞİ TAMAMLANDI ===\n")}}_()}catch(e){_(e)}})},78335:()=>{},86481:(e,i,t)=>{"use strict";t.d(i,{SB:()=>s,fH:()=>o,vF:()=>_,vV:()=>a});let _={info:(...e)=>{},error:(...e)=>{},warn:(...e)=>{},debug:(...e)=>{}},a=(e,i)=>{_.error(e,i)},o=(e,i)=>{_.info(e,i)},s=(e,i,t)=>{let a=`Webhook alındı: ${e} - Durum: ${i}`;"error"===i?_.error(a,t):_.info(a,t)}},94934:(e,i,t)=>{"use strict";t.a(e,async(e,_)=>{try{t.r(i),t.d(i,{patchFetch:()=>u,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>c});var a=t(96559),o=t(48088),s=t(37719),r=t(75577),n=e([r]);r=(n.then?(await n)():n)[0];let d=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/odoo-webhook/route",pathname:"/api/odoo-webhook",filename:"route",bundlePath:"app/api/odoo-webhook/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\odoo-webhook\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:l,workUnitAsyncStorage:c,serverHooks:m}=d;function u(){return(0,s.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:c})}_()}catch(e){_(e)}})},96487:()=>{}};var i=require("../../../webpack-runtime.js");i.C(e);var t=e=>i(i.s=e),_=i.X(0,[4447,580],()=>t(94934));module.exports=_})();