(()=>{var e={};e.id=702,e.ids=[702],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23990:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>f,routeModule:()=>g,serverHooks:()=>j,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>x});var r={};t.r(r),t.d(r,{GET:()=>m});var a=t(96559),n=t(48088),i=t(37719),o=t(32190),u=t(29021),l=t.n(u),d=t(33873),p=t.n(d),c=t(86481);async function m(e){try{let s;c.vF.info("\xd6ğrenci mesajları isteği alındı");let t=e.headers.get("x-user-email");if(!t)return c.vF.error("Kullanıcı email bilgisi bulunamadı"),o.NextResponse.json({success:!1,error:"Kullanıcı bilgisi bulunamadı"},{status:401});let r=p().join(process.cwd(),"data","messages.json");l().existsSync(r)||(c.vF.info("Mesaj veritabanı bulunamadı, yeni dosya oluşturuluyor"),await u.promises.writeFile(r,JSON.stringify({conversations:[]},null,2)));try{let e=await u.promises.readFile(r,"utf-8");s=JSON.parse(e)}catch(e){return c.vF.error("Mesaj veritabanı okuma hatası:",e),o.NextResponse.json({success:!1,error:"Mesaj veritabanı okunamadı"},{status:500})}let a=(s.conversations||[]).filter(e=>e.studentEmail.toLowerCase()===t.toLowerCase()).map(e=>{let s=e.messages[e.messages.length-1],r=e.messages.filter(e=>!e.isRead&&e.senderEmail!==t).length;return{id:parseInt(e.id.split("-")[1])||Date.now(),subject:e.subject,preview:s?s.content.substring(0,100):"",date:e.lastMessageAt,isRead:0===r,studentEmail:e.advisorEmail,studentName:e.advisorEmail.split("@")[0],messages:e.messages.map(e=>({sender:e.senderEmail===t?"user":"advisor",content:e.content,timestamp:e.timestamp}))}}).sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime());return c.vF.info("\xd6ğrenci mesajları başarıyla getirildi",{messageCount:a.length}),o.NextResponse.json({success:!0,tickets:a})}catch(e){return c.vF.error("\xd6ğrenci mesajları getirme hatası:",e),o.NextResponse.json({success:!1,error:"Mesajlar alınırken bir hata oluştu"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/student/messages/route",pathname:"/api/student/messages",filename:"route",bundlePath:"app/api/student/messages/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\student\\messages\\route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:v,workUnitAsyncStorage:x,serverHooks:j}=g;function f(){return(0,i.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:x})}},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},86481:(e,s,t)=>{"use strict";t.d(s,{SB:()=>i,fH:()=>n,vF:()=>r,vV:()=>a});let r={info:(...e)=>{},error:(...e)=>{},warn:(...e)=>{},debug:(...e)=>{}},a=(e,s)=>{r.error(e,s)},n=(e,s)=>{r.info(e,s)},i=(e,s,t)=>{let a=`Webhook alındı: ${e} - Durum: ${s}`;"error"===s?r.error(a,t):r.info(a,t)}},96487:()=>{}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4447,580],()=>t(23990));module.exports=r})();