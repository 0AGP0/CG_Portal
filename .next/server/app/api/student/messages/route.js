"use strict";(()=>{var e={};e.id=702,e.ids=[702],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{e.exports=import("pg")},84576:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>u});var s=r(32190),n=r(5069),i=r(86481),o=e([n]);async function u(e){try{i.vF.info("\xd6ğrenci mesajları isteği alındı");let t=e.headers.get("x-user-email");if(!t)return i.vF.error("Kullanıcı email bilgisi bulunamadı"),s.NextResponse.json({success:!1,error:"Kullanıcı bilgisi bulunamadı"},{status:401});let r=await (0,n.D6)(t,"student"),a=[];for(let e of r){let r=await (0,n.LW)(t,e.advisor_email),s=r[r.length-1],i=r.filter(e=>!e.is_read&&e.sender_email!==t).length;a.push({id:e.id,subject:e.subject||"Genel Konuşma",preview:s?s.content.substring(0,100):"",date:s?s.created_at:e.created_at,isRead:0===i,advisorEmail:e.advisor_email,advisorName:e.advisor_email.split("@")[0],messages:r.map(e=>({sender:e.sender_email===t?"user":"advisor",content:e.content,timestamp:e.created_at}))})}let o=a.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return i.vF.info("\xd6ğrenci mesajları başarıyla getirildi",{messageCount:o.length}),s.NextResponse.json({success:!0,tickets:o})}catch(e){return i.vF.error("\xd6ğrenci mesajları getirme hatası:",e),s.NextResponse.json({success:!1,error:"Mesajlar alınırken bir hata oluştu"},{status:500})}}n=(o.then?(await o)():o)[0],a()}catch(e){a(e)}})},85960:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{patchFetch:()=>d,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>c});var s=r(96559),n=r(48088),i=r(37719),o=r(84576),u=e([o]);o=(u.then?(await u)():u)[0];let l=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/student/messages/route",pathname:"/api/student/messages",filename:"route",bundlePath:"app/api/student/messages/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\student\\messages\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:p,workUnitAsyncStorage:c,serverHooks:m}=l;function d(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:c})}a()}catch(e){a(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,8033],()=>r(85960));module.exports=a})();