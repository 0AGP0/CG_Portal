(()=>{var e={};e.id=8081,e.ids=[8081],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73480:(e,s,r)=>{"use strict";r.r(s),r.d(s,{patchFetch:()=>f,routeModule:()=>g,serverHooks:()=>j,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>x});var t={};r.r(t),r.d(t,{GET:()=>c});var a=r(96559),n=r(48088),i=r(37719),o=r(32190),u=r(29021),l=r.n(u),d=r(33873),p=r.n(d),m=r(86481);async function c(e){try{let s;m.vF.info("Danışman mesajları isteği alındı");let r=e.headers.get("x-user-email");if(!r)return m.vF.error("Kullanıcı e-postası bulunamadı"),o.NextResponse.json({success:!1,error:"Kullanıcı e-postası gerekli"},{status:400});m.vF.info("Danışman mesajları getiriliyor",{userEmail:r});let t=p().join(process.cwd(),"data","messages.json");l().existsSync(t)||(m.vF.info("Mesaj veritabanı bulunamadı, yeni dosya oluşturuluyor"),await u.promises.writeFile(t,JSON.stringify({conversations:[]},null,2)));try{let e=await u.promises.readFile(t,"utf-8");s=JSON.parse(e)}catch(e){return m.vF.error("Mesaj veritabanı okuma hatası:",e),o.NextResponse.json({success:!1,error:"Mesaj veritabanı okunamadı"},{status:500})}let a=(s.conversations||[]).filter(e=>e.advisorEmail.toLowerCase()===r.toLowerCase()).map(e=>{let s=e.messages[e.messages.length-1],t=e.messages.filter(e=>!e.isRead&&e.senderEmail!==r).length;return{id:parseInt(e.id.split("-")[1])||Date.now(),subject:e.subject,preview:s?s.content.substring(0,100):"",date:e.lastMessageAt,isRead:0===t,studentEmail:e.studentEmail,studentName:e.studentEmail.split("@")[0],messages:e.messages.map(e=>({sender:e.senderEmail===r?"advisor":"user",content:e.content,timestamp:e.timestamp}))}}).sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime());return m.vF.info("Danışman mesajları başarıyla getirildi",{messageCount:a.length}),o.NextResponse.json({success:!0,tickets:a})}catch(e){return m.vF.error("Danışman mesajları getirme hatası:",e),o.NextResponse.json({success:!1,error:"Mesajlar alınırken bir hata oluştu"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/advisor/messages/route",pathname:"/api/advisor/messages",filename:"route",bundlePath:"app/api/advisor/messages/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\advisor\\messages\\route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:v,workUnitAsyncStorage:x,serverHooks:j}=g;function f(){return(0,i.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:x})}},78335:()=>{},86481:(e,s,r)=>{"use strict";r.d(s,{SB:()=>i,fH:()=>n,vF:()=>t,vV:()=>a});let t={info:(...e)=>{},error:(...e)=>{},warn:(...e)=>{},debug:(...e)=>{}},a=(e,s)=>{t.error(e,s)},n=(e,s)=>{t.info(e,s)},i=(e,s,r)=>{let a=`Webhook alındı: ${e} - Durum: ${s}`;"error"===s?t.error(a,r):t.info(a,r)}},96487:()=>{}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[4447,580],()=>r(73480));module.exports=t})();