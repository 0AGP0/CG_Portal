"use strict";(()=>{var e={};e.id=8081,e.ids=[8081],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21378:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{patchFetch:()=>d,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>c});var s=a(96559),n=a(48088),i=a(37719),o=a(83729),u=e([o]);o=(u.then?(await u)():u)[0];let l=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/advisor/messages/route",pathname:"/api/advisor/messages",filename:"route",bundlePath:"app/api/advisor/messages/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\advisor\\messages\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:p,workUnitAsyncStorage:c,serverHooks:m}=l;function d(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:c})}r()}catch(e){r(e)}})},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{e.exports=import("pg")},83729:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{GET:()=>u});var s=a(32190),n=a(5069),i=a(86481),o=e([n]);async function u(e){try{i.vF.info("Danışman mesajları isteği alındı");let t=e.headers.get("x-user-email");if(!t)return i.vF.error("Kullanıcı e-postası bulunamadı"),s.NextResponse.json({success:!1,error:"Kullanıcı e-postası gerekli"},{status:400});i.vF.info("Danışman mesajları getiriliyor",{userEmail:t});let a=await (0,n.D6)(t,"advisor"),r=[];for(let e of a){let a=await (0,n.LW)(e.student_email,t),s=a[a.length-1],i=a.filter(e=>!e.is_read&&e.sender_email!==t).length;r.push({id:e.id,subject:e.subject||"Genel Konuşma",preview:s?s.content.substring(0,100):"",date:s?s.created_at:e.created_at,isRead:0===i,studentEmail:e.student_email,studentName:e.student_email.split("@")[0],messages:a.map(e=>({sender:e.sender_email===t?"advisor":"user",content:e.content,timestamp:e.created_at}))})}let o=r.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return i.vF.info("Danışman mesajları başarıyla getirildi",{messageCount:o.length}),s.NextResponse.json({success:!0,tickets:o})}catch(e){return i.vF.error("Danışman mesajları getirme hatası:",e),s.NextResponse.json({success:!1,error:"Mesajlar alınırken bir hata oluştu"},{status:500})}}n=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[4447,580,8033],()=>a(21378));module.exports=r})();