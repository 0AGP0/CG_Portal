(()=>{var e={};e.id=3688,e.ids=[3688],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34808:(e,r,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.d(r,{A$:()=>p,Bx:()=>h,CT:()=>d,Wv:()=>m,Z7:()=>l,_Y:()=>u,iW:()=>c,kA:()=>w,v3:()=>i});var s=t(86481),n=t(64939),o=e([n]);new(n=(o.then?(await o)():o)[0]).Pool({user:process.env.POSTGRES_USER||"postgres",host:process.env.POSTGRES_HOST||"localhost",database:process.env.POSTGRES_DATABASE||"cg_portal",password:process.env.POSTGRES_PASSWORD,port:parseInt(process.env.POSTGRES_PORT||"5432"),ssl:{rejectUnauthorized:!1}});let f={customers:new Map,advisors:new Map,messages:new Map,lastUpdated:new Map};async function i(e){try{let r=f.customers.get(e),t=f.lastUpdated.get(e);if(r&&t&&Date.now()-t<3e5)return r;let a=await fetch("/api/student/profile",{headers:{"x-user-email":e,"Content-Type":"application/json"}});if(!a.ok)throw Error("\xd6ğrenci bilgisi alınamadı");let s=await a.json();if(!s.success)return null;return f.customers.set(e,s.student),f.lastUpdated.set(e,Date.now()),s.student}catch(e){return console.error("\xd6ğrenci kaydı getirme hatası:",e),null}}async function u(e,r){try{s.vF.info("Danışman arama başlatıldı:",e);let t=`advisor_${e}`,a=f.advisors.get(t);if(a)return s.vF.info("Danışman bilgileri cache'den getirildi:",e),a;if(!r)throw s.vF.error("Token bulunamadı"),Error("Oturum s\xfcresi doldu. L\xfctfen tekrar giriş yapın.");let n=`https://your-domain.com/api/advisor/${encodeURIComponent(e)}`;s.vF.info("Danışman API isteği g\xf6nderiliyor:",n);let o={"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${r}`,"x-user-email":e,"x-user-role":"advisor"},i=await fetch(n,{method:"GET",headers:o,credentials:"include"});if(!i.ok){if(401===i.status)throw s.vF.error("Danışman oturumu ge\xe7ersiz:",e),f.advisors.delete(t),Error("Oturum s\xfcresi doldu. L\xfctfen tekrar giriş yapın.");throw Error(`Danışman bilgileri alınamadı: ${i.statusText}`)}let u=await i.json();if(!u.success)throw s.vF.error("Danışman API yanıt hatası:",u.error),Error(u.error||"Danışman bilgileri alınamadı");let l=u.advisor;if(!l)return s.vF.error("Danışman bulunamadı:",e),null;return f.advisors.set(t,l),s.vF.info("Danışman bilgileri başarıyla getirildi:",e),l}catch(e){throw s.vF.error("Danışman kaydı getirme hatası:",e),e}}async function l(e){try{var r;let t=(r=`/api/messages/${e}/read`,`https://your-domain.com${r}`),a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok)throw Error("Mesaj okundu olarak işaretlenemedi");return(await a.json()).success}catch(e){return console.error("Mesaj okundu işaretleme hatası:",e),!1}}async function c(e){try{let r=await fetch("/api/student/profile",{method:"PUT",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!r.ok)throw Error("Kayıt g\xfcncellenemedi");return(await r.json()).student}catch(e){throw console.error("Kayıt g\xfcncelleme hatası:",e),e}}async function d(){try{let e=await fetch("/api/advisor/list");if(!e.ok)throw Error("Danışman listesi alınamadı");return(await e.json()).advisors||[]}catch(e){return console.error("Danışman listesi getirme hatası:",e),[]}}async function p(e){try{let r=await fetch("/api/student/documents",{method:"POST",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!r.ok)throw Error("D\xf6k\xfcman g\xfcncellenemedi");return(await r.json()).document}catch(e){throw console.error("D\xf6k\xfcman g\xfcncelleme hatası:",e),e}}async function m(e){try{let r=await fetch("/api/student/visa",{method:"PUT",headers:{"Content-Type":"application/json","x-user-email":e.email},body:JSON.stringify(e)});if(!r.ok)throw Error("Vize bilgisi g\xfcncellenemedi");return(await r.json()).student}catch(e){throw console.error("Vize g\xfcncelleme hatası:",e),e}}async function h(e){try{let r=await fetch("/api/advisor/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error("Danışman g\xfcncellenemedi");return(await r.json()).advisor}catch(e){throw console.error("Danışman g\xfcncelleme hatası:",e),e}}async function w(e){try{let r=await fetch(`/api/messages/${e}`);if(!r.ok)return null;return(await r.json()).message}catch(e){return console.error("Mesaj getirme hatası:",e),null}}a()}catch(e){a(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51830:(e,r,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{patchFetch:()=>l,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>p});var s=t(96559),n=t(48088),o=t(37719),i=t(76832),u=e([i]);i=(u.then?(await u)():u)[0];let c=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/messages/[id]/route",pathname:"/api/messages/[id]",filename:"route",bundlePath:"app/api/messages/[id]/route"},resolvedPagePath:"C:\\Users\\pc\\Downloads\\CG_Portal-main\\CG_Portal-main\\src\\app\\api\\messages\\[id]\\route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:d,workUnitAsyncStorage:p,serverHooks:m}=c;function l(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:p})}a()}catch(e){a(e)}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},76832:(e,r,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{GET:()=>u,PATCH:()=>l});var s=t(32190),n=t(34808),o=t(86481),i=e([n]);async function u(e,{params:r}){try{let t=r.id,a=e.headers.get("x-user-email");if(!a)return s.NextResponse.json({error:"Kullanıcı kimliği gereklidir"},{status:401});let o=await (0,n.kA)(t);if(!o)return s.NextResponse.json({error:"Mesaj bulunamadı"},{status:404});if(o.senderEmail.toLowerCase()!==a.toLowerCase()&&o.receiverEmail.toLowerCase()!==a.toLowerCase())return s.NextResponse.json({error:"Bu mesaja erişim izniniz yok"},{status:403});return o.receiverEmail.toLowerCase()!==a.toLowerCase()||o.isRead||(await (0,n.Z7)(t),o.isRead=!0),s.NextResponse.json({success:!0,message:o})}catch(e){return(0,o.vV)("Mesaj detayı hatası",e),s.NextResponse.json({error:"Mesaj alınırken bir hata oluştu"},{status:500})}}async function l(e,{params:r}){try{let t=r.id,a=e.headers.get("x-user-email");if(!a)return s.NextResponse.json({error:"Kullanıcı kimliği gereklidir"},{status:401});let o=await (0,n.kA)(t);if(!o)return s.NextResponse.json({error:"Mesaj bulunamadı"},{status:404});if(o.receiverEmail.toLowerCase()!==a.toLowerCase())return s.NextResponse.json({error:"Bu mesajı okundu olarak işaretleme izniniz yok"},{status:403});let i=await (0,n.Z7)(t);return s.NextResponse.json({success:!0,message:i})}catch(e){return(0,o.vV)("Mesaj okundu işaretleme hatası",e),s.NextResponse.json({error:"Mesaj okundu olarak işaretlenirken bir hata oluştu"},{status:500})}}n=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},78335:()=>{},86481:(e,r,t)=>{"use strict";t.d(r,{SB:()=>o,fH:()=>n,vF:()=>a,vV:()=>s});let a={info:(...e)=>{},error:(...e)=>{},warn:(...e)=>{},debug:(...e)=>{}},s=(e,r)=>{a.error(e,r)},n=(e,r)=>{a.info(e,r)},o=(e,r,t)=>{let s=`Webhook alındı: ${e} - Durum: ${r}`;"error"===r?a.error(s,t):a.info(s,t)}},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[4447,580],()=>t(51830));module.exports=a})();